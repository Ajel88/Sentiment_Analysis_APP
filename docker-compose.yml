services:
  # Service 1: ChromaDB
  chroma-db:
    image: chromadb/chroma:latest
    container_name: chroma-db
    ports:
      - "8001:8000"
    restart: unless-stopped

  # Service 2: ML Application
  ml-app:
    build: .
    container_name: ml-app
    ports:
      - "7860:7860"
    volumes:
      - ./:/app
    environment:
      # FORCE Docker service name (overrides config.json)
      CHROMA_HOST: "chroma-db"
      CHROMA_PORT: "8000"
      PYTHONUNBUFFERED: "1"
    depends_on:
      - chroma-db
    restart: unless-stopped

  # Service 3: Streamlit UI
  streamlit-ui:
    build: .
    container_name: streamlit-ui
    ports:
      - "8501:8501"
    volumes:
      - ./:/app
    depends_on:
      - ml-app
    restart: unless-stopped
    command: >
      sh -c "echo 'ðŸš€ Streamlit UI Container Running' && 
             echo 'ðŸ“Š Access Main App: http://localhost:7860' && 
             sleep infinity"